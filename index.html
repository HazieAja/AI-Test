<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>RL Maze with Key Challenge</title>
<style>
  body{
    margin:0;
    display:flex;
    justify-content:center;
    align-items:center;
    height:100vh;
    background:linear-gradient(135deg,#dbeafe,#fef3c7);
    font-family:monospace;
  }
  .panel{
    background:#ffffffcc;
    padding:20px 30px;
    border-radius:16px;
    box-shadow:0 20px 40px rgba(0,0,0,.15);
    text-align:center;
  }
  canvas{
    display:block;
    margin:15px auto;
    background:#f8fafc;
    border-radius:12px;
  }
  input{ width:200px; }
</style>
</head>
<body>

<div class="panel">
  <h2>AI Maze â€” Key Challenge</h2>
  <div id="info"></div>
  <canvas id="cv" width="480" height="480"></canvas>
  <div>
    Speed:
    <input type="range" min="10" max="200" value="60" id="speed">
  </div>
</div>

<script>
const SIZE=15, CELL=480/SIZE;
const cv=document.getElementById("cv");
const ctx=cv.getContext("2d");

let maze=[
 [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
 [1,'S',0,0,1,0,0,0,0,0,1,0,0,'K',1],
 [1,0,1,0,1,0,1,1,1,0,1,0,1,0,1],
 [1,0,1,0,0,0,0,0,1,0,0,0,1,0,1],
 [1,0,1,1,1,1,1,0,1,1,1,0,1,0,1],
 [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1],
 [1,1,1,1,1,0,1,1,1,0,1,1,1,0,1],
 [1,0,0,0,1,0,0,0,1,0,0,0,1,0,1],
 [1,0,1,0,1,1,1,0,1,1,1,0,1,0,1],
 [1,0,1,0,0,0,0,0,0,0,1,0,0,0,1],
 [1,0,1,1,1,1,1,1,1,0,1,1,1,'D',1],
 [1,0,0,0,0,0,0,0,1,0,0,0,0,0,1],
 [1,1,1,1,1,1,1,0,1,1,1,1,1,0,1],
 [1,0,0,0,0,0,0,0,0,0,0,0,0,'G',1],
 [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
];

const actions=[[1,0],[-1,0],[0,1],[0,-1]];
let Q={}, alpha=.15, gamma=.95, epsilon=.3;

let agent={r:1,c:1,key:false};
let episodes=0;

const k=(r,c,key)=>`${r},${c},${key}`;

function choose(s){
 if(Math.random()<epsilon) return Math.floor(Math.random()*4);
 let q=Q[s]||[0,0,0,0];
 return q.indexOf(Math.max(...q));
}

function step(){
 let s=k(agent.r,agent.c,agent.key);
 Q[s]=Q[s]||[0,0,0,0];
 let a=choose(s);
 let [dr,dc]=actions[a];
 let nr=agent.r+dr, nc=agent.c+dc;
 let reward=-1, newKey=agent.key;

 let cell=maze[nr]?.[nc];
 if(cell===1){ reward=-6; nr=agent.r; nc=agent.c; }
 if(cell==='D'&&!agent.key){ reward=-10; nr=agent.r; nc=agent.c; }
 if(cell==='K'){ reward=30; newKey=true; }
 if(cell==='G'){ reward=100; }

 let ns=k(nr,nc,newKey);
 Q[ns]=Q[ns]||[0,0,0,0];
 Q[s][a]+=alpha*(reward+gamma*Math.max(...Q[ns])-Q[s][a]);

 agent={r:nr,c:nc,key:newKey};

 if(cell==='G'){
   agent={r:1,c:1,key:false};
   episodes++;
 }
}

function draw(){
 ctx.clearRect(0,0,480,480);
 for(let r=0;r<SIZE;r++)for(let c=0;c<SIZE;c++){
  let x=c*CELL,y=r*CELL;
  if(maze[r][c]===1){ ctx.fillStyle="#e5e7eb"; ctx.fillRect(x,y,CELL,CELL); }
  if(maze[r][c]==='K'){ ctx.fillStyle="#facc15"; ctx.beginPath(); ctx.arc(x+CELL/2,y+CELL/2,8,0,7); ctx.fill(); }
  if(maze[r][c]==='D'){ ctx.fillStyle="#a16207"; ctx.fillRect(x+5,y+5,CELL-10,CELL-10); }
  if(maze[r][c]==='G'){ ctx.fillStyle="#ef4444"; ctx.fillRect(x+4,y+4,CELL-8,CELL-8); }
 }
 ctx.fillStyle=agent.key?"#2563eb":"#60a5fa";
 ctx.beginPath();
 ctx.arc(agent.c*CELL+CELL/2,agent.r*CELL+CELL/2,10,0,7);
 ctx.fill();

 document.getElementById("info").innerText=
 `Episode: ${episodes} | Key: ${agent.key}`;
}

let timer;
function run(){
 clearInterval(timer);
 timer=setInterval(()=>{ step(); draw(); },
   document.getElementById("speed").value);
}
document.getElementById("speed").oninput=run;
run();
</script>

</body>
</html>
